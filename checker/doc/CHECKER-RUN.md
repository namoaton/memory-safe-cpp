

Running checker tools
=====================

We will assume that `nodecpp-checker` and `nodecpp-safe-library` tools are already built and in the PATH.
If not, take a look at CHECKER-BUILD.md file.

Safe library database
---------------------

Rule 8 of STATIC-CHECKS.md states:

	[Rule S8] Prohibit functions except for those safe ones

In order to enforce such rule, exists the safe library database.
The safe library database is json serialized file used by `nodecpp-checker` and generated by `nodecpp-safe-library`, the file name is usualy `safe_library.json`

To generate a safe library database, we use `nodecpp-safe-library` tool. This tool will read a normal C++ header file (please use .hpp extension). Example:

	namespace fmt {
	namespace v5 {
		void print();
	}	
	}
	void make_owning();

	class owning_ptr;
	class naked_ptr;

This will create a safe library database that has the given functions and classes as safe.

When `nodecpp-checker` is run, we can pass a database path in the command line, or the tool will try to automatically find it in the same path of the source file, or any parent folder.
If no database is found, the tool will run anyway, but all functions and classes defined in _system_ libraries will be considered as __unsafe__


Checking code
-------------
To run the tool on a simple file (without any `#include`), and assuming that `safe_library.json` is in the same folder, just run:

	nodecpp-checker file.cpp --

If safe library database is at a different place, add command line argument:

	nodecpp-checker file.cpp -safe-library-db=/path/to/safe_library.json --


If we need to include some library (like `fmt` or `safe_ptr`) then we add `isystem` after the double hypen with the include path

	nodecpp-checker file.cpp -- -isystem /absolute/path/to/library/include/

After the double hypen, we can also add any compiler flag our code may need, like defines

	nodecpp-checker file.cpp -- -DNDEBUG


It is important that the tool gets exactly the same code than the compiler will see after preprocessing.
Bacuse of that, is important to have the same set of includes and defines.

Like all tools based on clang tooling, `nodecpp-checker` has three ways of doing that.

1. Like shown before, add the same command line options after the double hypen.
2. Put a file named `compiler_flags.txt` on the same folder that the source, with the options.
3. Use a compilation database generated by `cmake` or similar tool (`compile_commands.json`)

For more information, please see https://clang.llvm.org/docs/JSONCompilationDatabase.html

